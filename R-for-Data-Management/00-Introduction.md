# Introduction

## 학습 목적

데이터 관리에 유용한 R 도구들을 소개한다.

`tidyverse` 패키지 묶음에 있는 도구들에 중점을 두고 있으며, 또한 `tidyverse` 도구들을 보완해 주는 다른 패키지들의 다양한 도구들을 알아본다.

## 이 과정에서 사용되는 주요 데이터 관리 패키지들

`tidyverse`: 데이터 분석을 위한 다양한 도구들을 갖추는 패키지 묶음으로 특히 데이터 입력, 관리 그리고 시각화 등에 특히 강점을 가지고 있다. 이 과정에서는 `tidyverse`내의 다음의 패키지들을 중점적으로 살펴볼 것이다.

- `readr` : `read_csv()`와 같은 업데이트된 데이터 가져오기 함수들을 포함
- `dplyr` : 서브세팅, 정렬, 변수 변환, 그루핑 등
- `tidyr` : 행과 열의 재구조화
- `magrittr` : 일련의 명령어들을 파이핑
- `lubridate` : 날짜와 시간 변수 처리
- `stringr` : 문자열 변수의 조작

`Hmisc`: 데이터 분석을 위한 대부분의  도구를 담고있는 또 다른 패키지로, 여기서는 데이터 세트의 요약 함수인 `describe()`를 활용할 것이다. 



### `tidyverse`와 `Hmisc` 패키지 설치 및 사용

```{}
install.packages("tidyverse", dependencies=TRUE)
install.packages("Hmisc", dependencies=TRUE)
```

```{r}
library(tidyverse)
library(Hmisc)
```



## `tidyverse` 선언

데이터 과학 모형개발과 자료분석에서 R 패키지 도구상자를 잘 갖추는 것도 중요한 작업이다. 다행히도, 최근에 [`tidyverse`](https://cran.r-project.org/web/packages/tidyverse/index.html) 패키지가 새로 나와 많은 부분 체계화되었다. 사실 오픈소스 프로젝트가 성공되기 위해서 극복해야 되는 중요한 일중의 하나가 너무 많은 소프트웨어 덩어리를 정리하여 핵심적인 코드를 선별하여 다양성을 갖추면서도 성능과 신뢰성을 확보하는 것이 중요하다.

![깜끔한 세상](images/Thu,%2009%20Jul%202020%20074559.png)

`tidyverse`는 Hadley Wickham의 오랜 작업을 나름대로의 방식으로 집대성하여 데이터과학을 유사한 방식으로 접근하고자 하는 데이터과학자 및 실무자에게 도움을 주고자 한다. 어떻게 보면 오픈소스 운동의 커다란 동력이 될 수도 있다.

R 언어 기반의 만개가 넘는 패키지가 개발되어 활용되고 있으나, 각자의 설계원칙에 맞춰 제각기 개발되고 손을 바꿔 다른 사람들이 오랜동안 이어 받아 진행되어 초기 세워진 설계원칙이 많이 무너진 것도 사실이다. 이에 `tidyverse`는 데이터과학에 그동안 R 패키지를 개발하면서 축척된 경험과 노하우를 기반으로 R 설계 원칙을 정립하고자 한다.

엉망진창인 R 도구상자(`messyverse`)와 비교하여 깔끔한 R 도구상자(`tidyverse`)는 깔끔한(tidy) API에 다음과 같은 4가지 원칙을 제시한다.

- 기존 자료구조를 재사용: Reuse existing data structures.
- 파이프 연산자로 간단한 함수를 조합: Compose simple functions with the pipe.
- 함수형 프로그래밍을 적극 사용: Embrace functional programming.
- 기계가 아닌 인간을 위한 설계: Design for humans.

**시각화(Visualization)**는 데이터에 대한 통찰력(insight)과 탄성, 놀라움을 줄 수 있지만, 확장성(Scalability)은 떨어진다. 왜냐하면, 사람이 데이터 분석 루프에 포함되기 때문에 확장 및 자동화에 한계가 있다. 반대로 **모형(Model)**은 자동화와 확장성에는 장점이 있지만, 주어진 모형틀안에서 이루어지기 때문에 통찰력, 놀라움, 탄성을 주지는 못하는 아쉬움이 있다.

가능하면 **기존 자료구조**를 재사용한다. `ggplot2`, `dplyr`, `tidyr`을 포함한 대다수 R 패키지는 칼럼에 변수, 행에 관측점을 갖는 직사각형 형태 데이터셋을 가정한다. 그리고, 일부 패키지는 특정한 변수 자료형에 집중한다. `stringr`은 문자열, `lubridate`는 날짜/시간, `forcats`는 요인 자료형에 집중한다.

**파이프 연산자**로 간단한 함수를 조합하여 시스템 전체의 힘을 극대화한다. 복잡한 문제를 해결하는 강력한 전략은 단순한 많은 조각으로 나누고 이를 조합하는 것이다. 단, 각 조각은 격리되어 쉽게 파악되고, 다른 조각과 조합할 수 있는 표준이 성립되어야 된다. R에 파이프 연산자를 사용하여 본 전략이 구현되어 있다. `%>%` 연산자는 많은 패키지에 두루 걸쳐 동작되는 일반적인 결합 방식으로 이를 위해 함수를 작성할 때 다음 원칙을 갖고 작성한다.

- 함수를 가능하면 단순하게 작성한다. 일반적으로 각 함수는 한가지 작업을 매우 잘해야 되고, 한 문장으로 함수 존재목적을 기술할 수 있어야 된다.
- 변형(transformation)과 부작용(side-effect)을 뒤섞지 마라. 함수가 객체를 반환하거나, 부작용을 일으키거나 둘 중 하나만 동작하게 만든다.
- 함수명은 동사가 되어야 한다. 하지만, 예외로 대다수 함수가 동일한 동사를 사용한다. 예를 들어 `modify`, `add`, `compute` 등을 들 수 있다. 이런 경우 반복되는 동사가 중복되지 않도록 명사에 집중한다. `ggplot2`가 좋은 예가 되는데 기존 플롯에 좌표, 점, 범례 등을 거의 모든 함수가 추가하기 때문이다.

R은 함수형 언어라 객체지향언어나 다른 언어 패러다임과 싸우려고 하지 말고 받아들여라. 이것이 의미하는 바는 다음과 같다.

- 상태불변 객체: 작성된 코드에 대한 추론이 쉬움.
- S3, S4 에서 제공하는 제네릭 함수: 상태변형 가능한 상태가 필요하다면, 파이프 내부에서 구현.
- for 루프를 추상화한 도구: `apply` 함수 가족과 `purrr` 맵함수

데이터과학에서 병목점으로 문제가 발생되는 곳은 공통적으로 컴퓨터 실행시간(computing time)이 아니라 **사람의 생각(thinking time)**의 시간이다. 따라서, 함수명을 작성할 때 생각이 잘 연상되는 이름을 작명하는데 시간을 적절히 안분하고, 명시적이고 긴 명칭을 변수명, 함수명, 객체명에 사용하고, 짧은 명칭은 가장 중요한 이름으로 활용한다. RStudio 소스 편집기의 자동완성기능을 사용하는 경우 접두어가 접미어보다 중요하고, `stringr`, `xml2`, `rvest` 패키지를 살펴보면 접두어에 일관된 명칭을 부여한 장점을 알수 있다.

[ https://statkclee.github.io/data-science/ds-tidyverse.html ]